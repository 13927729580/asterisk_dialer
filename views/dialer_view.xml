<?xml version='1.0' encoding='utf-8'?>
<openerp> <data>
    
   <record id='dialer_cdr' model='ir.actions.act_window'>
        <field name='name'>Dialer Stats</field>
        <field name='view_mode'>tree,form,graph</field>
        <field name='res_model'>asterisk.dialer.cdr</field>
        <field name='context'>{'search_default_today': 1, 'search_default_by_dialer':1, 'search_default_by_session':1 }</field>
    </record>    
    
    <record id='dialer_view_form' model='ir.ui.view'>
        <field name='name'>Dialer Form</field>
        <field name='model'>asterisk.dialer</field>
        <field name='type'>form</field>
        <field name='arch' type='xml'>
            <form string='Dialer' edit='1'>
                <header>
                    <field name='active_session' invisible='1'/>
                    <field name='active_session_state' invisible='1'/>
                    <field name='pause_request' invisible='1' string='Pause'/>
                    <field name='cancel_request' invisible='1' string='Cancel'/>
                    <field name="state" invisible='1'/>    
                    <button class='oe_highlight oe_read_only' name='start' type='object' string='Start' attrs="{'invisible': ['|', ('active_session_state','=','running'),('active_session_state','=','paused')]}"/>
                    <button class='oe_highlight oe_read_only' name='pause' type='object' string='Pause' 
                        attrs="{'invisible': ['|','|',('cancel_request','=',True),('pause_request','=',True),('active_session_state','!=','running')]}"/>
                    <button class='oe_read_only' name='cancel' type='object' string='Cancel' 
                        attrs="{'invisible': ['|','|',('pause_request','=',True),('cancel_request','=',True),('active_session_state','!=', 'running')]}"/>
                    <button class='oe_highlight oe_read_only' name='resume' type='object' string='Resume' attrs="{'invisible': [('active_session_state','!=', 'paused')]}"/>
                    <button class='oe_read_only' name='reset' type='object' string='Reset'/>
                    <div class='oe_form_box_info oe_center' attrs="{'invisible': [('cancel_request','!=',True)]}">
                        <p><strong>Cancelling in  progress. Please wait for current session to terminate...</strong></p>
                    </div>
                    <div class='oe_form_box_info oe_center' attrs="{'invisible': [('pause_request','!=',True)]}">
                        <p><strong>Pause in  progress. Please wait for current session to terminate...</strong></p>
                    </div>                    
                </header>                
                <sheet>
                    <div class='oe_title oe_left'>
                            <h1>
                                <field name='name'/> 
                            </h1>
                           
                    </div>
                    <div class='oe_button_box oe_right'>
                            <button class="oe_inline oe_stat_button" type="action" name="%(dialer_cdr)d" icon="fa-phone" 
                                    context="{'search_default_dialer_id': active_id}">
                                <field string="Call Statistics" name="cdr_count" widget="statinfo"/>
                            </button>
                    </div>

                    <group>
                        <group> 
                            <field name='dialer_type'/>
                            <field name='context_name' attrs="{'invisible': [('dialer_type','=','playback')]}"/>
                            <field name='sound_file'  attrs="{'invisible': [('dialer_type','!=','playback')]}"/>
                            <field name='dialer_model'/>
                            <field name="dialer_domain" widget="char_domain" placeholder="Select subscribers" 
                                options="{'model_field': 'dialer_model'}" context="{'search_default_has_phone': 1}"/>
                            <field name='simult'/>
                        </group>
                        <group string='Time constraints'>
                            <field name='from_time' widget='float_time'/>
                            <field name='to_time' widget='float_time'/>
                        </group>
                    </group>

                    <group string='Current calls'>
                            <field name="channels" nolabel='1'>
                                <tree edit="false" create="false" delete='true'>
                                    <field name="name"/>
                                    <field name="phone"/>
                                </tree>
                            </field>
                    </group>
                    <group string='Sessions'>
                            <field name="sessions" nolabel='1'>
                                <tree edit="false" create="false" delete='false'>
                                    <field name='state'/>
                                    <field name='progress' widget='progressbar' string='Progress'/>
                                    <field name='total'/>
                                    <field name='sent'/>
                                    <field name='answer'/>
                                    <field name='busy'/>
                                    <field name='congestion'/>
                                    <field name='noanswer'/>
                                    <field name='chanunavail'/>
                                </tree>
                            </field>
                    </group>
                    
                    <div class='oe_chatter'>
                        <field name='message_follower_ids' widget='mail_followers'/>
                        <field name='message_ids' widget='mail_thread'/>
                    </div>
                    
                </sheet>
            </form>
        </field>
    </record>

    <record id='dialer_view_tree' model='ir.ui.view'>
        <field name='name'>Dialer Tree</field>
        <field name='model'>asterisk.dialer</field>
        <field name='type'>tree</field>
        <field name='arch' type='xml'>
            <tree string='Dialers'>
                <field name='name'/>
                <field name='state' string='State'/>
            </tree>
        </field>
    </record>
    
    <record id='dialer' model='ir.actions.act_window'>
        <field name='name'>Dialer</field>
        <field name='view_mode'>tree,form</field>
        <field name='res_model'>asterisk.dialer</field>
        <field name='context'>{'mail_create_nolog': '1'}</field>
        <field name='help' type='html'>
            <p class='oe_view_nocontent_create'>Click to create a new Dialer.</p>
            <p>Dialer is used to dial Partners (dialer model is set to <i>Contacts</i>) or custom list of phone numbers (dialer model is set to <i>Subscribers list</i>).</p>
            <p>After a call is answered Dialer can either playback a message (Dialer type is set to <i>Playback message</i>) or connect the call to Asterisk dialplan 
            where system administrator can configure his custom dialplan like the following:</p>
            <pre><code>[queue]
exten => _X.,1,Queue(test)</code></pre>
        </field>
    </record>
    
    
    <record id='session_view_form' model='ir.ui.view'>
        <field name='name'>Session Form</field>
        <field name='model'>asterisk.dialer.session</field>
        <field name='type'>form</field>
        <field name='arch' type='xml'>
            <form string='Session'>
                <sheet>
                    <group>
                        <group>
                            <field name='state'/>
                            <field name='start_time'/>
                            <field name='end_time'/>
                            <field name='progress' widget='progressbar' string='Progress'/>
                            <field name='total'/>
                            <field name='sent'/>
                            <field name='answer'/>
                        </group>
                        <group>
                            <field name='busy'/>
                            <field name='congestion'/>
                            <field name='noanswer'/>
                            <field name='chanunavail'/>string='Progress
                            <field name='cancel_request'/>
                            <field name='pause_request'/>
                        </group>
                    </group>
                    <field name='cdrs'>
                        <tree create='false' delete='false' edit='false' nolabel='1'>
                            <field name='phone'/>
                            <field name='name'/>
                            <field name='status'/>
                        </tree>
                    </field>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- 
    <record id='session' model='ir.actions.act_window'>
        <field name='name'>Session Action</field>
        <field name='view_mode'>tree</field>
        <field name='res_model'>asterisk.dialer.session</field>
    </record>    
    -->
    
    
    <record id='dialer_subscriber_list_tree' model='ir.ui.view'>
        <field name='name'>Dialer Subscriber List Tree</field>
        <field name='model'>asterisk.dialer.subscriber.list</field>
        <field name='type'>tree</field>
        <field name='arch' type='xml'>
            <tree string='Subscriber Lists' editable='top'>
                <field name='name'/>
                <field name='subscriber_count' readonly='1' string='Subscribers count'/>
            </tree>
        </field>
    </record>

   <record id='dialer_subscriber_list' model='ir.actions.act_window'>
        <field name='name'>Dialer Subscriber List</field>
        <field name='view_mode'>tree,form</field>
        <field name='res_model'>asterisk.dialer.subscriber.list</field>
    </record>    
    

    <record id='dialer_subscribers_tree' model='ir.ui.view'>
        <field name='name'>Dialer Subscribers</field>
        <field name='model'>asterisk.dialer.subscriber</field>
        <field name='type'>tree</field>
        <field name='arch' type='xml'>
            <tree string='Subscribers' editable='top'>
                <field name='subscriber_list'/>
                <field name='phone'/>
                <field name='name'/>
            </tree>
        </field>
    </record>
    
    <record id='asterisk_dialer_subscriber_search' model='ir.ui.view'>
        <field name='name'>Subscriber Search</field>
        <field name='model'>asterisk.dialer.subscriber</field>
        <field name='type'>search</field>
        <field name='arch' type='xml'>
            <search string='Subscribers search'>
                <group string='Group by'>
                    <filter string='List' context="{'group_by': 'subscriber_list'}"/>
                </group>
            </search>
        </field>
    </record>

   <record id='dialer_subscribers' model='ir.actions.act_window'>
        <field name='name'>Dialer Subscribers</field>
        <field name='view_mode'>tree,form</field>
        <field name='res_model'>asterisk.dialer.subscriber</field>
    </record>    


    <record id='dialer_stats_tree' model='ir.ui.view'>
        <field name='name'>Dialer Statistics</field>
        <field name='model'>asterisk.dialer.cdr</field>
        <field name='type'>tree</field>        
        <field name='arch' type='xml'>
            <tree string='Statistics'>
                <field name='phone'/>
                <field name='name'/>                
                <field name='status'/>
                <field name='start_time'/>
                <field name='end_time'/>
                <field name='answered_time_str' string='Answer time'/>
                <field name='answered_time' sum='1'/>
            </tree>
        </field>
    </record>
    
   <record id='dialer_stats_form' model='ir.ui.view'>
        <field name='name'>Call Detail Record</field>
        <field name='model'>asterisk.dialer.cdr</field>
        <field name='type'>form</field>        
        <field name='arch' type='xml'>
            <form string='Statistics' create='0' edit='0' delete='0'>
            <sheet>
            <group>
             <group>
                <field name='dialer'/>
                <field name='session'/>
                <field name='phone'/>
                <field name='name'/>
                <field name='status'/>
                <field name='start_time'/>
                <field name='end_time'/>
                <field name='answered_time_str' string='Answer time'/>                
             </group>
             <group>
                <field name='channel_id'/>
                <field name='other_channel_id'/>
                <field name='playback_start_time'/>
                <field name='playback_end_time'/>
                <field name='playback_duration_str'/>
             </group>
            </group>
            </sheet>
            </form>
        </field>
    </record>
    
    <record id='dialer_stats_search' model='ir.ui.view'>
        <field name='name'>Dialer Stats Search</field>
        <field name='model'>asterisk.dialer.cdr</field>
        <field name='type'>search</field>
        <field name='arch' type='xml'>
            <search string='Search Stats'>
                <group string='Date'>
                    <filter name='today' icon="terp-project" string='Today' 
                        domain="[('start_time','&gt;=',time.strftime('%Y-%m-%d 00:00:00')),('start_time','&lt;=',time.strftime('%Y-%m-%d 23:59:59'))]"/>
                </group>
                <group string='Status'>
                    <filter string='Answered' domain="[('status','=','ANSWER')]"/>
                    <filter string='Busy' domain="[('status','=','BUSY')]"/>
                    <filter string='Congestion' domain="[('status','=','CONGESTION')]"/>
                    <filter string='No answer' domain="[('status','=','NOANSWER')]"/>
                    <filter string='Channel unavailable' domain="[('status','=','CHANUNAVAIL')]"/>
                    <filter string='Cancel' domain="[('status','=','CANCEL')]"/>
                </group>
                <group string='Group by'>
                    <filter name='by_dialer' string='Dialer' context="{'group_by': 'dialer'}"/>
                    <filter name='by_session' string='Session' context="{'group_by': 'session'}"/>
                    <filter string='Status' context="{'group_by': 'status'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!--
        <record id="view_dialer_stats_diagram" model="ir.ui.view">
        <field name="name">asterisk.dialer.cdr</field>
        <field name="model">asterisk.dialer.cdr</field>
        <field name="arch" type="xml">
            <diagram string="CDR stats">
                <node object="asterisk.dialer.cdr" shape="rectangle:type=='subcampaign'" bgcolor="gray:start==True">
                    <field name="name"/>
                    <field name="type"/>
                    <field name="start" invisible="1"/>
                    <field name="condition" widget="char"/>
                </node>
                <arrow object="marketing.campaign.transition" source="activity_from_id" destination="activity_to_id" label="['name']">
                    <field name="activity_from_id"/>
                    <field name="activity_to_id"/>
                    <field name="interval_nbr"/>
                    <field name="interval_type"/>
                </arrow>
            </diagram>
        </field>
    </record>
    -->
    
       <record id="asterisk_dialer_cdr_graph" model="ir.ui.view">
            <field name="name">asterisk.dialer.cdr.graph</field>
            <field name="model">asterisk.dialer.cdr</field>
            
            <field name="arch" type="xml">
                <graph orientation="horizontal" string="Calls" stacked="True">
                    <field name="start_time" type="row"/>
                    <field name='status' type='col'/>
                </graph>
            </field>
        </record>        


    <menuitem id='asterisk_topmenu' name='Asterisk'/>
    <menuitem id='asterisk_dialer' name='Dialer' parent='asterisk_topmenu'/>
    <menuitem id='asterisk_dialer_dialer' name='Dialer' parent='asterisk_dialer' action='dialer'/>
    <menuitem id='asterisk_dialer_cdr' name='Stats' parent='asterisk_dialer' action='dialer_cdr'/>
    <menuitem id='asterisk_dialer_subscriber_list' name='Subscriber lists' parent='asterisk_dialer' action='dialer_subscriber_list'/>
    <menuitem id='asterisk_dialer_subscribers' name='Subscribers' parent='asterisk_dialer' action='dialer_subscribers'/>

</data></openerp>